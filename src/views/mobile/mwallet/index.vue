<template>
  <div class="container">
    <div class="top">
      <div class="icon">
        <svg
          width="40"
          height="40"
          viewBox="0 0 40 40"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M40 12.5108C40 12.0307 40 11.5505 40 11.0837C40 10.6836 39.9867 10.2835 39.9867 9.86998C39.9598 8.9897 39.9066 8.10939 39.7598 7.24243C39.6 6.36216 39.3465 5.54852 38.933 4.74829C38.5328 3.96133 38.0127 3.2411 37.3858 2.61422C36.7589 1.98735 36.0387 1.46719 35.2518 1.06703C34.4515 0.653517 33.6379 0.400001 32.7576 0.240235C31.8906 0.0800782 31.0103 0.0265625 30.13 0.0132813C29.7299 0 29.3298 0 28.9163 0C28.4362 0 27.956 0 27.4892 0H12.5108C12.0307 0 11.5505 0 11.0837 0C10.6836 0 10.2834 0.0132813 9.86993 0.0132813C8.98965 0.0402344 8.10938 0.0933595 7.24242 0.240235C6.36211 0.400001 5.54851 0.653517 4.74824 1.06703C3.96132 1.46719 3.24107 1.98739 2.6142 2.61422C1.98732 3.2411 1.46715 3.96133 1.06702 4.74829C0.653548 5.54852 0.400129 6.36216 0.240078 7.24243C0.0800235 8.10939 0.0266719 8.9897 0.013336 9.86998C0 10.2701 0 10.6703 0 11.0837C0 11.5639 0 12.044 0 12.5108V27.4892C0 27.9693 0 28.4495 0 28.9163C0 29.3165 0.013336 29.7166 0.013336 30.13C0.0400118 31.0104 0.0933634 31.8906 0.240078 32.7576C0.400129 33.6379 0.653548 34.4515 1.06702 35.2517C1.46715 36.0387 1.98732 36.7589 2.6142 37.3858C3.24107 38.0127 3.96132 38.5328 4.74824 38.933C5.54851 39.3465 6.36211 39.5999 7.24242 39.7599C8.10938 39.92 8.98965 39.9733 9.86993 39.9867C10.2701 40 10.6702 40 11.0837 40H28.9163C29.3164 40 29.7166 39.9867 30.13 39.9867C31.0103 39.96 31.8906 39.9066 32.7576 39.7599C33.6378 39.5999 34.4514 39.3465 35.2517 38.933C36.0386 38.5328 36.7589 38.0127 37.3857 37.3858C38.0126 36.7589 38.5328 36.0387 38.9329 35.2517C39.3465 34.4515 39.6 33.6379 39.7598 32.7576C39.9199 31.8906 39.9734 31.0104 39.9867 30.13C40 29.7299 40 29.3298 40 28.9163V12.5108Z"
            fill="url(#paint0_linear)"
            fill-opacity="0.2"
          />
          <mask
            id="mask0"
            mask-type="alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="40"
            height="40"
          >
            <path
              d="M40 12.5108C40 12.0307 40 11.5505 40 11.0837C40 10.6836 39.9867 10.2835 39.9867 9.86998C39.9598 8.9897 39.9066 8.10939 39.7598 7.24243C39.6 6.36216 39.3465 5.54852 38.933 4.74829C38.5328 3.96133 38.0127 3.2411 37.3858 2.61422C36.7589 1.98735 36.0387 1.46719 35.2518 1.06703C34.4515 0.653517 33.6379 0.400001 32.7576 0.240235C31.8906 0.0800782 31.0103 0.0265625 30.13 0.0132813C29.7299 0 29.3298 0 28.9163 0C28.4362 0 27.956 0 27.4892 0H12.5108C12.0307 0 11.5505 0 11.0837 0C10.6836 0 10.2834 0.0132813 9.86993 0.0132813C8.98965 0.0402344 8.10938 0.0933595 7.24242 0.240235C6.36211 0.400001 5.54851 0.653517 4.74824 1.06703C3.96132 1.46719 3.24107 1.98739 2.6142 2.61422C1.98732 3.2411 1.46715 3.96133 1.06702 4.74829C0.653548 5.54852 0.400129 6.36216 0.240078 7.24243C0.0800235 8.10939 0.0266719 8.9897 0.013336 9.86998C0 10.2701 0 10.6703 0 11.0837C0 11.5639 0 12.044 0 12.5108V27.4892C0 27.9693 0 28.4495 0 28.9163C0 29.3165 0.013336 29.7166 0.013336 30.13C0.0400118 31.0104 0.0933634 31.8906 0.240078 32.7576C0.400129 33.6379 0.653548 34.4515 1.06702 35.2517C1.46715 36.0387 1.98732 36.7589 2.6142 37.3858C3.24107 38.0127 3.96132 38.5328 4.74824 38.933C5.54851 39.3465 6.36211 39.5999 7.24242 39.7599C8.10938 39.92 8.98965 39.9733 9.86993 39.9867C10.2701 40 10.6702 40 11.0837 40H28.9163C29.3164 40 29.7166 39.9867 30.13 39.9867C31.0103 39.96 31.8906 39.9066 32.7576 39.7599C33.6378 39.5999 34.4514 39.3465 35.2517 38.933C36.0386 38.5328 36.7589 38.0127 37.3857 37.3858C38.0126 36.7589 38.5328 36.0387 38.9329 35.2517C39.3465 34.4515 39.6 33.6379 39.7598 32.7576C39.9199 31.8906 39.9734 31.0104 39.9867 30.13C40 29.7299 40 29.3298 40 28.9163V12.5108Z"
              fill="white"
            />
          </mask>
          <g mask="url(#mask0)">
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M22.2369 15.1093V17.8041C27.2403 18.0353 31 19.0273 31 20.2153C31 21.4032 27.2403 22.3952 22.2369 22.6253V31.2631H17.7802V22.6276C12.7688 22.3964 9 21.4043 9 20.2153C9 19.0262 12.7688 18.033 17.7802 17.803V15.1093H11.6139V11H28.4032V15.1093H22.2369ZM22.2369 21.8907V21.8929C26.656 21.697 29.9533 20.9282 29.9533 20.0057C29.9533 19.0854 26.656 18.3144 22.2369 18.1173V21.1276C22.1082 21.139 21.4191 21.1959 20.0444 21.1959C18.8986 21.1959 18.0695 21.1469 17.7802 21.1264V18.115C13.3519 18.3132 10.0467 19.0843 10.0467 20.0057C10.0467 20.9282 13.3519 21.6993 17.7802 21.8941V21.8907C18.0649 21.9043 18.8747 21.9385 20.0251 21.9385C21.4658 21.9385 22.1116 21.8998 22.2369 21.8907Z"
              fill="url(#paint1_linear)"
            />
          </g>
          <defs>
            <linearGradient
              id="paint0_linear"
              x1="-19.0689"
              y1="19.4287"
              x2="19.4287"
              y2="57.9263"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#5914FA" />
              <stop offset="0.525813" stop-color="#824DFF" />
              <stop offset="1" stop-color="#917AFF" />
            </linearGradient>
            <linearGradient
              id="paint1_linear"
              x1="-1.48789"
              y1="20.8421"
              x2="17.9484"
              y2="41.9444"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#5914FA" />
              <stop offset="0.525813" stop-color="#824DFF" />
              <stop offset="1" stop-color="#917AFF" />
            </linearGradient>
          </defs>
        </svg>
      </div>
      <p class="yue1">{{walletsTotal.totalAmountToCoin}}</p>
      <p class="yue2">≈ ¥ {{walletsTotal.totalAmountToCny}}</p>
      <div class="detail">
        <div class="left">
          <p class="m">{{wallets.availableCoinNum}}</p>
          <p class="des">可用（USDT）</p>
        </div>
        <svg
          width="1"
          height="39"
          viewBox="0 0 1 39"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <rect width="1" height="39" fill="#EDEDF2" />
        </svg>

        <div class="right">
          <p class="m">{{wallets.frozenCoinNum}}</p>
          <p class="des">冻结（USDT）</p>
        </div>
      </div>
      <router-link to="/mwalletRecord" class="btn">查看充提记录</router-link>
    </div>
    <div class="records">
      <h3>财务记录</h3>
      <van-list
        v-if="!nolist"
       v-model="loading"
        :finished="finished"
        @load="onLoad">
        <ul class="records-list">
          <li  v-for="(item, index) in data" :key="index">
            <div class="left">
              <p class="m">{{item.tradeType == 3 ? '买入' : '卖出' }}{{item.coinName}}</p>
              <p class="des">{{item.createTime - 0 | parseTime('{y}-{m}-{d} {h}:{i}:{s}')}}</p>
            </div>
            <div class="right">
              <p class="m">{{item.tradeType == 3 ? '+' : '-'}}{{item.coinNum}}</p>
              <p class="des">已完成</p>
            </div>
          </li>
        </ul>
      </van-list>
      <nolist v-if="nolist" class="nolist" />
    </div>
    <div class="bottom">
      <router-link to="/mCharges">充币</router-link>
      <router-link to="/mwithdrawal">提币</router-link>
    </div>
  </div>
</template>

<script>
import nolist from "@/components/nolist/index";
import userInfoApi from "@/api/userInfo";
import buyApi from '@/api/buy'
export default {
  data() {
    return {
      wallets:{
        availableCoinNum:'0.00',
        frozenCoinNum:'0.00'
      },
      walletsTotal:{},
      loading: true, // 上拉加载
      finished: false, // 上拉加载完毕
      table:{
        coinName:'USDT',
        current:1,
        size:10,
      },
      total:0,//总数
      data:[],
      nolist: false // 没有数据展示
    };
  },
  props: {},
  components: {
    nolist
  },
  mounted() {
    this.getWalletTotal()
    this.getWallet()
    this.getWalletFlows()
  },
  methods: {
    //获取钱包流水
    getWalletFlows(){
      this.nolist = false;
      userInfoApi.getWalletFlows(this.table).then(res => {
        let rows = [];
        res.data.data.records.map(item => {
          if(item.tradeType == 3 || item.tradeType == 4){
            rows.push(item)
          }
        })
        this.loading = false;
        this.total = res.data.data.total - 0;
        if(rows == null || rows.length == 0){
          this.finished = true
          // this.nolist = true;
          return
        }
        
        this.data = this.data.concat(rows)
        if (this.data.length >= this.total) {
            this.finished = true;
          }
      })
    },
    onLoad() {
      this.table.current++;
      this.getWalletFlows();
    },
    //获取钱包列表 及详情
    getWallet(){
      userInfoApi.getWallet({}).then(res => {
        let id  = res.data.data[0].id
        if(id){
          userInfoApi.getWallDetails({
            id:id
          }).then(res => {
            console.log(res)
            this.wallets = res.data.data
          })
        }
      })
    },
    //获取钱包总额
    getWalletTotal(){
      userInfoApi.getWalletTotal({}).then(res => {
        this.walletsTotal = res.data.data
        console.log(res)
      })
    },
  },
};
</script>

<style lang="less" scoped>
.container {
  .top {
    padding: 0 0.32rem;
    width: 100%;
    background-color: #f7f7fa;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    .icon {
      margin-top: 0.6rem;
      width: 0.8rem;
      height: 0.8rem;
    }
    .yue1 {
      margin-top: 0.32rem;
      font-size: 0.64rem;
    }
    .yue2 {
      margin-top: 0.08rem;
      color: #a0a0b3;
      font-size: 0.32rem;
    }
    .detail {
      margin-top: 0.48rem;
      border: 1px solid #ededf2;
      background-color: #fff;
      width: 100%;
      display: flex;
      justify-content: space-around;
      align-items: center;
      height: 1.34rem;

      .left,
      .right {
        width: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .m {
        font-size: 0.36rem;
      }
      .des {
        font-size: 0.26rem;
        color: #a0a0b3;
      }
    }

    .btn {
      margin-top: 0.28rem;
      margin-bottom: 0.56rem;
      border: 1px solid #ededf2;
      width: 100%;
      height: 0.8rem;
      font-size: 0.28rem;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #0cb397;
      background: #FCFCFF;
    }
  }
  .records {
    padding: 0 0.32rem;
    h3 {
      font-weight: 500;
      font-size: 0.32rem;
      line-height: 1.4rem;
      height: 1.24rem;
      color: #a0a0b3;
    }
    .records-list {
      margin-bottom: 1.08rem;
      .m {
        font-size: 0.28rem;
      }
      .des {
        font-size: 0.24rem;
      }
      & > li {
        height: 1.28rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        .right {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
        }
        p {
          margin-top: 0.08rem;
        }
      }
      li {
        border-bottom: solid 1px  #f5f5fa;
      }
    }
  }
  .bottom{
    position: fixed;
    bottom:0;
    width:100%;
    height:1.08rem;
    display: flex;
    justify-content: space-evenly;
    align-items:center;
    background-color: #fff;
    box-shadow: 0px -2px 8px rgba(64, 64, 94, 0.04);

    a{
      display: inline-block;
      height:0.76rem;
      line-height: 0.76rem;
      width:45%;
      border-radius: 0.76rem;
      font-size:0.28rem;
      text-align: center;
      color:#fff;
    }
    a:nth-child(1){
      background-color:  #0CB397;;
    }
    a:nth-child(2){
      background-color:  #F46666;;;
    }
  }
}
</style>
